(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1760:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=1760,e.exports=t},3487:(e,t,a)=>{"use strict";function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(s)}function i(e){let[t,a,s]=e.split("-").map(Number);return new Date(t,(null!=a?a:1)-1,null!=s?s:1)}function n(e){let t=i(e),a=t.getDate(),s=a%10==1&&a%100!=11?"st":a%10==2&&a%100!=12?"nd":a%10==3&&a%100!=13?"rd":"th";return"".concat(t.toLocaleDateString(void 0,{month:"long",day:"numeric"})).concat(s,"’s habits")}function l(e){return i(e).toLocaleDateString(void 0,{month:"short",day:"numeric"})}a.d(t,{KS:()=>l,RX:()=>n,kQ:()=>s})},4983:(e,t,a)=>{"use strict";a.d(t,{N:()=>s});let s=(0,a(2354).UU)("https://giaibbhanqkjyutdkbie.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpYWliYmhhbnFranl1dGRrYmllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NTQ3ODcsImV4cCI6MjA3MDUzMDc4N30.m2nW2vtmDqR2A3LG7-uoX1I6Kf-H7szmYVypl3b-kQo",{auth:{persistSession:!0,autoRefreshToken:!0}})},6636:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(5155),i=a(2115),n=a(4983);function l(e){let{selectedDate:t}=e,a=(0,i.useMemo)(()=>t,[t]),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)({}),[h,m]=(0,i.useState)(!1),[b,f]=(0,i.useState)(!1),[x,g]=(0,i.useState)(""),[p,N]=(0,i.useState)("✅"),[j,v]=(0,i.useState)(null);async function y(){let{data:{user:e}}=await n.N.auth.getUser();if(!e)return;let[t,s]=await Promise.all([n.N.from("habits").select("id,name,emoji").order("created_at",{ascending:!0}),n.N.from("habit_entries").select("habit_id").eq("date",a)]);!t.error&&t.data&&c(t.data);let i={};!s.error&&s.data&&s.data.forEach(e=>i[e.habit_id]=!0),u(i)}async function k(e){try{if(v(e),d[e]){let{error:t}=await n.N.from("habit_entries").delete().eq("habit_id",e).eq("date",a);if(t)throw t}else{let{data:{user:t}}=await n.N.auth.getUser();if(!t)throw Error("Not signed in");let{error:s}=await n.N.from("habit_entries").insert({habit_id:e,user_id:t.id,date:a,completed:!0});if(s)throw s}u(t=>({...t,[e]:!t[e]}))}catch(e){alert((null==e?void 0:e.message)||"Could not update"),console.error(e)}finally{v(null)}}async function C(){if(!x.trim())return;let{data:{user:e}}=await n.N.auth.getUser();if(!e)return alert("Sign in first");let{data:t,error:a}=await n.N.from("habits").insert({user_id:e.id,name:x.trim(),emoji:p}).select("id,name,emoji").single();if(a)return alert(a.message);c(e=>[...e,t]),g(""),N("✅"),m(!1)}async function w(e){let{error:t}=await n.N.from("habits").delete().eq("id",e);if(t)return alert(t.message);c(t=>t.filter(t=>t.id!==e)),u(t=>{let{[e]:a,...s}=t;return s})}return(0,i.useEffect)(()=>{y()},[a]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"h-title",children:"  "}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",className:"btn-ghost ".concat(b?"border-red-500 text-red-600":""),onClick:()=>f(e=>!e),title:"Delete mode",children:"❌"}),(0,s.jsx)("button",{type:"button",className:"btn-ghost",onClick:()=>m(e=>!e),title:"Add habit",children:"➕"})]})]}),(0,s.jsxs)("ul",{className:"divide-y",children:[l.map(e=>{let t=!!d[e.id];return(0,s.jsxs)("li",{className:"flex items-center gap-3 py-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>k(e.id),className:"chk ".concat(t?"chk-on":""),"aria-label":t?"Uncheck habit":"Check habit","aria-pressed":t,children:t&&(0,s.jsx)("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M3 8l3 3 7-7"})})}),(0,s.jsx)(r,{value:e.emoji,onChange:async t=>{let{error:a}=await n.N.from("habits").update({emoji:t}).eq("id",e.id);a||c(a=>a.map(a=>a.id===e.id?{...a,emoji:t}:a))}}),(0,s.jsx)(o,{initial:e.name,onSave:t=>n.N.from("habits").update({name:t}).eq("id",e.id).then(a=>{let{error:s}=a;s||c(a=>a.map(a=>a.id===e.id?{...a,name:t}:a))}),className:"flex-1"}),b&&(0,s.jsx)("button",{type:"button",className:"btn-ghost text-xs",onClick:()=>w(e.id),children:"Delete"})]},e.id)}),0===l.length&&(0,s.jsx)("li",{className:"py-6 muted",children:"No habits yet — click ➕ to add."})]}),h&&(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,s.jsx)(r,{value:p,onChange:N}),(0,s.jsx)("input",{className:"flex-1 input",placeholder:"Habit name",value:x,onChange:e=>g(e.target.value)}),(0,s.jsx)("button",{type:"button",className:"btn-primary",onClick:C,children:"Add"})]})]})}function r(e){let{value:t,onChange:a}=e,[n,l]=(0,i.useState)(!1);return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("button",{type:"button",className:"w-8 h-8 text-lg",onClick:()=>l(e=>!e),title:"Emoji",children:t}),n&&(0,s.jsx)("div",{className:"absolute z-50 mt-1 bg-white border rounded-lg shadow p-2 grid grid-cols-5 gap-1",children:["✅","\uD83D\uDD25","\uD83D\uDCA7","\uD83D\uDCDA","\uD83E\uDDD8\uD83C\uDFFD‍♀️","\uD83E\uDD57","\uD83D\uDCAA\uD83C\uDFFD","\uD83C\uDF19","\uD83E\uDDF4","\uD83E\uDDF9"].map(e=>(0,s.jsx)("button",{type:"button",className:"w-8 h-8 text-lg hover:bg-black/5 rounded",onClick:()=>{a(e),l(!1)},children:e},e))})]})}function c(e){let{selectedDate:t,onClose:a}=e;return(0,s.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/30",children:(0,s.jsxs)("div",{className:"section w-[320px] text-center",children:[(0,s.jsx)("h3",{className:"h-title mb-2",children:"Clear this day?"}),(0,s.jsxs)("p",{className:"muted mb-4",children:["This will remove all check-ins for ",(0,s.jsx)("strong",{children:t}),"."]}),(0,s.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,s.jsx)("button",{type:"button",className:"btn-ghost",onClick:a,children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"btn-primary",onClick:()=>{try{let e=localStorage.getItem("lifestack_data");if(e){let a=JSON.parse(e);delete a[t],localStorage.setItem("lifestack_data",JSON.stringify(a))}}catch(e){console.error("Failed to clear day",e)}finally{a()}},children:"Clear"})]})]})})}function o(e){let{initial:t,onSave:a,className:n}=e,[l,r]=(0,i.useState)(t),[c,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>r(t),[t]),c?(0,s.jsx)("form",{className:n,onSubmit:e=>{e.preventDefault(),o(!1),l.trim()&&l!==t&&a(l.trim())},children:(0,s.jsx)("input",{autoFocus:!0,value:l,onChange:e=>r(e.target.value),onBlur:()=>{o(!1),l.trim()&&l!==t&&a(l.trim())},className:"w-full border rounded-lg p-1.5"})}):(0,s.jsx)("button",{type:"button",onClick:()=>o(!0),className:"".concat(n," text-left hover:underline"),children:l})}var d=a(3487);function u(){let[e,t]=(0,i.useState)(""),[a,n]=(0,i.useState)(!1),r=(0,i.useRef)(null);return((0,i.useEffect)(()=>t((0,d.kQ)()),[]),e)?(0,s.jsxs)("main",{className:"container-page",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:(0,s.jsxs)("div",{className:"col-span-1 lg:col-span-2 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"h-title",children:(0,d.RX)(e)}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{ref:r,type:"date",className:"sr-only",value:e,onChange:e=>t(e.target.value),max:(0,d.kQ)()}),(0,s.jsx)("button",{className:"btn-ghost",onClick:()=>{var e,t;return null==(t=r.current)||null==(e=t.showPicker)?void 0:e.call(t)},title:"Pick date",children:"\uD83D\uDCC5"}),(0,s.jsx)("button",{className:"btn-ghost text-[var(--color-accent)]",onClick:()=>n(!0),children:"Clear this day"})]})]}),(0,s.jsx)("div",{className:"section",children:(0,s.jsx)(l,{selectedDate:e})})]})}),a&&(0,s.jsx)(c,{selectedDate:e,onClose:()=>n(!1)})]}):null}},7006:(e,t,a)=>{Promise.resolve().then(a.bind(a,6636))}},e=>{e.O(0,[354,441,964,358],()=>e(e.s=7006)),_N_E=e.O()}]);