(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3487:(e,t,a)=>{"use strict";function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)}function i(e){let[t,a,n]=e.split("-").map(Number);return new Date(t,(null!=a?a:1)-1,null!=n?n:1)}function s(e){let t=i(e),a=t.getDate(),n=a%10==1&&a%100!=11?"st":a%10==2&&a%100!=12?"nd":a%10==3&&a%100!=13?"rd":"th";return"".concat(t.toLocaleDateString(void 0,{month:"long",day:"numeric"})).concat(n,"’s habits")}function l(e){return i(e).toLocaleDateString(void 0,{month:"short",day:"numeric"})}a.d(t,{KS:()=>l,RX:()=>s,kQ:()=>n})},4983:(e,t,a)=>{"use strict";a.d(t,{N:()=>n});let n=(0,a(2354).UU)("https://giaibbhanqkjyutdkbie.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpYWliYmhhbnFranl1dGRrYmllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5NTQ3ODcsImV4cCI6MjA3MDUzMDc4N30.m2nW2vtmDqR2A3LG7-uoX1I6Kf-H7szmYVypl3b-kQo",{auth:{persistSession:!0,autoRefreshToken:!0}})},6636:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var n=a(5155),i=a(2115),s=a(7650),l=a(4983);let r="aurova.guest.habits.v1",c=e=>"aurova.guest.entries.".concat(e,".v1");function o(e,t){try{let a=localStorage.getItem(e);return a?JSON.parse(a):t}catch(e){return t}}function d(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}}function u(e){let{selectedDate:t}=e,a=(0,i.useMemo)(()=>t,[t]),[s,u]=(0,i.useState)([]),[h,g]=(0,i.useState)({}),[b,p]=(0,i.useState)(!1),[x,N]=(0,i.useState)(!1),[j,y]=(0,i.useState)(""),[v,k]=(0,i.useState)("✅"),[w,S]=(0,i.useState)(null);async function C(){let{data:{user:e}}=await l.N.auth.getUser();if(!e){u(o(r,[])),g(o(c(a),{}));return}let[t,n]=await Promise.all([l.N.from("habits").select("id,name,emoji").order("created_at",{ascending:!0}),l.N.from("habit_entries").select("habit_id").eq("date",a)]);!t.error&&t.data&&u(t.data);let i={};!n.error&&n.data&&n.data.forEach(e=>i[e.habit_id]=!0),g(i)}async function I(e){try{S(e);let t=!!h[e],{data:{user:n}}=await l.N.auth.getUser();if(!n){let n=c(a),i=o(n,{});t?delete i[e]:i[e]=!0,d(n,i),g(i);return}if(t){let{error:t}=await l.N.from("habit_entries").delete().eq("habit_id",e).eq("date",a);if(t)throw t}else{let{data:{user:t}}=await l.N.auth.getUser();if(!t)throw Error("Not signed in");let{error:n}=await l.N.from("habit_entries").insert({habit_id:e,user_id:t.id,date:a,completed:!0});if(n)throw n}g(t=>({...t,[e]:!t[e]}))}catch(e){alert((null==e?void 0:e.message)||"Could not update"),console.error(e)}finally{S(null)}}async function D(){if(!j.trim())return;let{data:{user:e}}=await l.N.auth.getUser();if(!e){let e=[...o(r,[]),{id:"undefined"!=typeof crypto&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),name:j.trim(),emoji:v}];d(r,e),u(e),y(""),k("✅"),p(!1);return}let{data:t,error:a}=await l.N.from("habits").insert({user_id:e.id,name:j.trim(),emoji:v}).select("id,name,emoji").single();if(a)return alert(a.message);u(e=>[...e,t]),y(""),k("✅"),p(!1)}async function E(e){let{data:{user:t}}=await l.N.auth.getUser();if(!t){let t=o(r,[]).filter(t=>t.id!==e);d(r,t),u(t);let n=c(a),i=o(n,{});e in i&&(delete i[e],d(n,i)),g(t=>{let{[e]:a,...n}=t;return n});return}let{error:n}=await l.N.from("habits").delete().eq("id",e);if(n)return alert(n.message);u(t=>t.filter(t=>t.id!==e)),g(t=>{let{[e]:a,...n}=t;return n})}return(0,i.useEffect)(()=>{C()},[a]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("h3",{className:"h-title",children:"  "}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{type:"button",className:"btn-ghost ".concat(x?"border-red-500 text-red-600":""),onClick:()=>N(e=>!e),title:"Delete mode",children:"❌"}),(0,n.jsx)("button",{type:"button",className:"btn-ghost",onClick:()=>p(e=>!e),title:"Add habit",children:"➕"})]})]}),(0,n.jsxs)("ul",{className:"divide-y",children:[s.map(e=>{let t=!!h[e.id];return(0,n.jsxs)("li",{className:"flex items-center gap-3 py-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>I(e.id),className:"chk ".concat(t?"chk-on":""),"aria-label":t?"Uncheck habit":"Check habit","aria-pressed":t,disabled:w===e.id,children:t&&(0,n.jsx)("svg",{viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,n.jsx)("path",{d:"M3 8l3 3 7-7"})})}),(0,n.jsx)(m,{value:e.emoji,onChange:async t=>{let{data:{user:a}}=await l.N.auth.getUser();if(!a){let a=o(r,[]).map(a=>a.id===e.id?{...a,emoji:t}:a);d(r,a),u(a);return}let{error:n}=await l.N.from("habits").update({emoji:t}).eq("id",e.id);n||u(a=>a.map(a=>a.id===e.id?{...a,emoji:t}:a))}}),(0,n.jsx)(f,{initial:e.name,onSave:async t=>{let{data:{user:a}}=await l.N.auth.getUser();if(!a){let a=o(r,[]).map(a=>a.id===e.id?{...a,name:t}:a);d(r,a),u(a);return}let{error:n}=await l.N.from("habits").update({name:t}).eq("id",e.id);n||u(a=>a.map(a=>a.id===e.id?{...a,name:t}:a))},className:"flex-1"}),x&&(0,n.jsx)("button",{type:"button",className:"btn-ghost text-xs",onClick:()=>E(e.id),children:"Delete"})]},e.id)}),0===s.length&&(0,n.jsx)("li",{className:"py-6 muted",children:"No habits yet — click ➕ to add."})]}),b&&(0,n.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,n.jsx)(m,{value:v,onChange:k}),(0,n.jsx)("input",{className:"flex-1 input",placeholder:"Habit name",value:j,onChange:e=>y(e.target.value)}),(0,n.jsx)("button",{type:"button",className:"btn-primary",onClick:D,children:"Add"})]})]})}function m(e){let{value:t,onChange:a}=e,[l,r]=(0,i.useState)(!1),c=(0,i.useRef)(null),o=(0,i.useRef)(null),[d,u]=(0,i.useState)({top:0,left:0});return(0,i.useEffect)(()=>{if(!l||!c.current)return;let e=c.current.getBoundingClientRect(),t=Math.min(Math.max(8,e.left),window.innerWidth-240-8);u({top:e.bottom+8,left:t})},[l]),(0,i.useEffect)(()=>{if(!l)return;let e=e=>{o.current&&!o.current.contains(e.target)&&c.current&&!c.current.contains(e.target)&&r(!1)},t=e=>{"Escape"===e.key&&r(!1)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[l]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{ref:c,type:"button",className:"w-8 h-8 text-lg",onClick:()=>r(e=>!e),title:"Emoji",children:t}),l&&(0,s.createPortal)((0,n.jsx)("div",{ref:o,className:"fixed z-[9999] w-[240px] rounded-xl border bg-white shadow-lg p-2",style:{top:d.top,left:d.left},role:"listbox",children:(0,n.jsx)("div",{className:"grid grid-cols-6 gap-1",children:["✅","\uD83D\uDD25","\uD83D\uDCA7","\uD83D\uDCDA","\uD83E\uDDD8\uD83C\uDFFD‍♀️","\uD83E\uDD57","\uD83D\uDCAA\uD83C\uDFFD","\uD83C\uDF19","\uD83E\uDDF4","\uD83E\uDDF9","\uD83D\uDEB0","\uD83E\uDDE0","\uD83E\uDDFA","\uD83E\uDDFD","\uD83D\uDECF️","\uD83E\uDDD1\uD83C\uDFFE‍\uD83C\uDF73"].map(e=>(0,n.jsx)("button",{type:"button",className:"w-8 h-8 text-lg rounded hover:bg-black/5",onClick:()=>{a(e),r(!1)},children:e},e))})}),document.body)]})}function h(e){let{selectedDate:t,onClose:a}=e;return(0,n.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/30",children:(0,n.jsxs)("div",{className:"section w-[320px] text-center",children:[(0,n.jsx)("h3",{className:"h-title mb-2",children:"Clear this day?"}),(0,n.jsxs)("p",{className:"muted mb-4",children:["This will remove all check-ins for ",(0,n.jsx)("strong",{children:t}),"."]}),(0,n.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,n.jsx)("button",{type:"button",className:"btn-ghost",onClick:a,children:"Cancel"}),(0,n.jsx)("button",{type:"button",className:"btn-primary",onClick:()=>{try{localStorage.removeItem(c(t));let e=localStorage.getItem("lifestack_data");if(e){let a=JSON.parse(e);delete a[t],localStorage.setItem("lifestack_data",JSON.stringify(a))}}catch(e){console.error("Failed to clear day",e)}finally{a()}},children:"Clear"})]})]})})}function f(e){let{initial:t,onSave:a,className:s}=e,[l,r]=(0,i.useState)(t),[c,o]=(0,i.useState)(!1);return(0,i.useEffect)(()=>r(t),[t]),c?(0,n.jsx)("form",{className:s,onSubmit:e=>{e.preventDefault(),o(!1),l.trim()&&l!==t&&a(l.trim())},children:(0,n.jsx)("input",{autoFocus:!0,value:l,onChange:e=>r(e.target.value),onBlur:()=>{o(!1),l.trim()&&l!==t&&a(l.trim())},className:"w-full border rounded-lg p-1.5"})}):(0,n.jsx)("button",{type:"button",onClick:()=>o(!0),className:"".concat(s," text-left hover:underline"),children:l})}var g=a(3487);function b(){let[e,t]=(0,i.useState)(""),[a,s]=(0,i.useState)(!1),l=(0,i.useRef)(null);return((0,i.useEffect)(()=>t((0,g.kQ)()),[]),e)?(0,n.jsxs)("main",{className:"container-page",children:[(0,n.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:(0,n.jsxs)("div",{className:"col-span-1 lg:col-span-2 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"h-title",children:(0,g.RX)(e)}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{ref:l,type:"date",className:"sr-only",value:e,onChange:e=>t(e.target.value),max:(0,g.kQ)()}),(0,n.jsx)("button",{className:"btn-ghost",onClick:()=>{var e,t;return null==(t=l.current)||null==(e=t.showPicker)?void 0:e.call(t)},title:"Pick date",children:"\uD83D\uDCC5"}),(0,n.jsx)("button",{className:"btn-ghost text-[var(--color-accent)]",onClick:()=>s(!0),children:"Clear this day"})]})]}),(0,n.jsx)("div",{className:"section",children:(0,n.jsx)(u,{selectedDate:e})})]})}),a&&(0,n.jsx)(h,{selectedDate:e,onClose:()=>s(!1)})]}):null}},7006:(e,t,a)=>{Promise.resolve().then(a.bind(a,6636))}},e=>{e.O(0,[354,441,964,358],()=>e(e.s=7006)),_N_E=e.O()}]);